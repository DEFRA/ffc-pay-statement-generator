asyncapi: 2.4.0
info:
  title: FFC Payment Statement Generator
  version: '1.0.0'
  description: Generate PDF payment statements
channels:
  payment/request:
    subscribe:
      message:
        $ref: '#/components/messages/PaymentStatement'
components:
  messages:
    PaymentStatement:
      name: Payment statement
      contentType: application/json
      payload:
        $ref: '#/components/schemas/PaymentStatement'
  schemas:
    PaymentStatement:
      type: object
      required:
      - sourceSystem
      - sbi
      - marketingYear
      - paymentRequestNumber
      - invoiceNumber
      - agreementNumber
      - value
      - invoiceLines
      properties:
        sourceSystem:
          $ref: '#/components/schemas/SourceSystem'
        sbi:
          $ref: '#/components/schemas/SBI'
        marketingYear:
          $ref: '#/components/schemas/MarketingYear'
        paymentRequestNumber:
          $ref: '#/components/schemas/PaymentRequestNumber'
        correlationId:
          $ref: '#/components/schemas/CorrelationId'
        invoiceNumber:
          $ref: '#/components/schemas/InvoiceNumber'
        agreementNumber:
          $ref: '#/components/schemas/AgreementNumber'
        contractNumber:
          $ref: '#/components/schemas/ContractNumber'
        currency:
          $ref: '#/components/schemas/Currency'
        schedule:
          $ref: '#/components/schemas/Schedule'
        dueDate:
          $ref: '#/components/schemas/DueDate'
        value:
          $ref: '#/components/schemas/ValueDecimal'
        debtType:
          $ref: '#/components/schemas/DebtType'
        recoveryDate:
          $ref: '#/components/schemas/RecoveryDate'
        invoiceLines:
          type: array
          description: List of Invoice lines that make up request
          items:
            type: object
            required:
            - standardCode
            - description
            - value
            properties:
              standardCode:
                $ref: '#/components/schemas/StandardCode'
              description:
                $ref: '#/components/schemas/Description'
              value:
                $ref: '#/components/schemas/ValueDecimal'
    PaymentRequestSitiAgri:
      type: object
      required:
      - sourceSystem
      - frn
      - marketingYear
      - paymentRequestNumber
      - invoiceNumber
      - agreementNumber
      - contractNumber
      - value
      - invoiceLines
      properties:
        sourceSystem:
          $ref: '#/components/schemas/SourceSystem'
        frn:
          $ref: '#/components/schemas/FRN'
        marketingYear:
          $ref: '#/components/schemas/MarketingYear'
        paymentRequestNumber:
          $ref: '#/components/schemas/PaymentRequestNumber'
        correlationId:
          $ref: '#/components/schemas/CorrelationId'
        invoiceNumber:
          $ref: '#/components/schemas/InvoiceNumber'
        agreementNumber:
          $ref: '#/components/schemas/AgreementNumber'
        contractNumber:
          $ref: '#/components/schemas/ContractNumber'
        currency:
          $ref: '#/components/schemas/Currency'
        schedule:
          $ref: '#/components/schemas/Schedule'
        dueDate:
          $ref: '#/components/schemas/DueDate'
        value:
          $ref: '#/components/schemas/ValueDecimal'
        invoiceLines:
          type: array
          description: List of Invoice lines that make up request
          items:
            type: object
            required:
            - schemeCode
            - description
            - value
            properties:
              schemeCode:
                $ref: '#/components/schemas/SchemeCode'                
              accountCode:
                $ref: '#/components/schemas/AccountCode'                
              description:
                $ref: '#/components/schemas/Description'
              value:
                $ref: '#/components/schemas/ValueDecimal'
    PaymentRequestEnriched:
      type: object
      properties:
        sourceSystem:
          $ref: '#/components/schemas/SourceSystem'          
        frn:
          $ref: '#/components/schemas/FRN'  
        marketingYear:
          $ref: '#/components/schemas/MarketingYear'  
        paymentRequestNumber:
          $ref: '#/components/schemas/PaymentRequestNumber'  
        correlationId:
          $ref: '#/components/schemas/CorrelationId'  
        invoiceNumber:
          $ref: '#/components/schemas/InvoiceNumber'  
        agreementNumber:
          $ref: '#/components/schemas/AgreementNumber'
        contractNumber:
          $ref: '#/components/schemas/ContractNumber'
        currency:
          $ref: '#/components/schemas/Currency'
        schedule:
          $ref: '#/components/schemas/Schedule'
        dueDate:
          $ref: '#/components/schemas/DueDate'
        value:
          $ref: '#/components/schemas/ValueInteger'
        schemeId:
          $ref: '#/components/schemas/SchemeId'
        ledger:
          $ref: '#/components/schemas/Ledger'
        deliveryBody:
          $ref: '#/components/schemas/DeliveryBody'
        debtType:
          $ref: '#/components/schemas/DebtType'
        recoveryDate:
          $ref: '#/components/schemas/RecoveryDate'
        invoiceLines:
          type: array
          description: List of Invoice lines that make up request
          items:
            type: object
            properties:
              standardCode:
                $ref: '#/components/schemas/StandardCode'
              description:
                $ref: '#/components/schemas/Description'
              value:
                $ref: '#/components/schemas/ValueInteger'
              schemeCode:
                $ref: '#/components/schemas/SchemeCode'
              fundCode:
                $ref: '#/components/schemas/FundCode'
              accountCode:
                $ref: '#/components/schemas/AccountCode'
    SourceSystem:
      type: string
      description: System identifier request originates from
      example: AHWR
    SBI:
      type: number
      description: Single Business Identifier
      minimum: 105000000
      maximum: 999999999
      example: 123456789
    FRN:
      type: number
      description: Firm Reference Number
      minimum: 1000000000
      maximum: 9999999999
      example: 1234567890
    MarketingYear:
      type: number
      description: Scheme year for request
      minimum: 2021
      maximum: 2099
      example: 2022
    PaymentRequestNumber:
      type: number
      description: Version of payment request starting with 1, anything greater than 1 is an adjustment
      minimum: 1
      maximum: 99
    CorrelationId:
      type: string
      format: uuid
      description: GUID for event correlation, optional
      example: ce6ec916-bebe-4bc0-bad1-255298c82845
    InvoiceNumber:
      type: string
      description: Unique identifier for payment request
      example: A12345678S1234567V001
    AgreementNumber:
      type: string
      description: Unique reference number for agreement/application
      example: AHWR12345678
    ContractNumber:
      type: string
      description: Contract reference number of agreement
      example: S1234567
    Currency:
      type: string
      description: Currency of values in request. If not supplied will default to GBP.
      example: GBP
      enum:
      - GBP
      - EUR
      default: GBP
    Schedule:
      type: string
      description: Payment frequency instruction for DAX, eg Q4 for quarterly payments, optional.
      enum:
      - Q4
      - M12
      - T4
    DueDate:
      type: string
      format: DD/MM/YYYY, YYYY/MM/DD, DD-MM-YYYY or YYYY-MM-DD
      description: Date request should be issued from.  If not supplied will default to current date.
      example: 09/11/2022
      default: Current date
    ValueDecimal:
      type: number
      format: decimal
      description: Decimal net value of request before enrichment, ie decimal value in specified currency
      minimum: 0.00
      maximum: 999999999999.99
      example: 500.00
    ValueInteger:
      type: number
      format: integer
      description: value of request or invoice line after enrichment with main and fractional currency combined
      minimum: 0
      maximum: 999999999999
      example: 50000
    StandardCode:
      type: string
      description: Unique funding option code to be mapped to scheme code
      example: ahwr-cows
    SchemeCode:
      type: string
      description: Unique funding option code
      example: A1234
    AccountCode:
      type: string
      description: Unique account code for budgeting
      example: SOS123
    FundCode:
      type: string
      description: Unique fund code to pay from
      example: DRD10
    DeliveryBody:
      type: string
      description: Delivery body responsible for payment
      example: RP00
    Description:
      type: string
      description: Description of what line relates to, eg gross or penalty
      example: G00 - Gross value of claim
    SchemeId:
      type: number
      format: integer
      description: Unique ID for scheme used internal to payment services
      example: 1
    Ledger:
      type: string
      description: Target ledger for settlement, AP for Accounts Payable and AR for Accounts Receivable
      example: AP
      enum:
      - AP
      - AR
    DebtType:
      type: string
      description: Only for recoveries, reason for recovery. adm for administrative and irr for irregular debt
      example: irr
      enum:
        - irr
        - adm
    RecoveryDate:
      type: string
      format: DD/MM/YYYY, YYYY/MM/DD, DD-MM-YYYY or YYYY-MM-DD
      description: Only for recoveries, date debt was discovered
      example: 09/11/2021
